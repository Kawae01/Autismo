<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>üêç Cobrinha Bonita</title>
<style>
  body {
    margin: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    background: #0f3d0f; /* verde escuro ao redor */
    height: 100vh;
    overflow: hidden;
    font-family: 'Courier New', monospace;
  }

  canvas {
    border: 15px solid black; /* borda preta */
    background: #1e5f1e; /* verde do campo */
    display: block;
    box-shadow: 0 0 20px #000; /* sombra */
  }

  #menu, #gameOver {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8);
    padding: 30px;
    border-radius: 20px;
    color: white;
    text-align: center;
    z-index: 2;
    display: none;
  }

  #menu.active, #gameOver.active {
    display: block;
  }

  #menu input, #menu select, #menu button {
    margin: 10px 0;
    padding: 10px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
  }

  #score {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-size: 22px;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000;
    z-index: 2;
  }

  #ranking {
    margin-top: 15px;
    text-align: left;
    font-size: 14px;
  }
</style>
</head>
<body>

<!-- Menu inicial -->
<div id="menu" class="active">
  <h1>üêç Jogo da Cobrinha</h1>
  <input type="text" id="playerName" placeholder="Digite seu nome">
  <br>
  <label>Cor da Cobra: </label>
  <select id="snakeColor">
    <option value="green">Verde</option>
    <option value="blue">Azul</option>
    <option value="purple">Roxo</option>
    <option value="orange">Laranja</option>
    <option value="pink">Rosa</option>
  </select>
  <br>
  <label>Dificuldade: </label>
  <select id="difficulty">
    <option value="150">F√°cil</option>
    <option value="100" selected>M√©dio</option>
    <option value="70">Dif√≠cil</option>
  </select>
  <br>
  <button onclick="startGame()">Iniciar</button>

  <div id="ranking">
    <h3>üèÜ Ranking</h3>
    <ol id="rankingList"></ol>
  </div>
</div>

<!-- Tela de Game Over -->
<div id="gameOver">
  <h2 id="gameOverText"></h2>
  <button onclick="restartGame()">Jogar Novamente</button>
  <button onclick="backToMenu()">Voltar ao Menu</button>
</div>

<!-- Placar -->
<div id="score"></div>

<!-- Jogo -->
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreDisplay = document.getElementById("score");
const menu = document.getElementById("menu");
const gameOverScreen = document.getElementById("gameOver");
const gameOverText = document.getElementById("gameOverText");
const rankingList = document.getElementById("rankingList");

function resizeCanvas() {
  // deixa o canvas menor para aparecer borda ao redor
  canvas.width = window.innerWidth * 0.9;
  canvas.height = window.innerHeight * 0.9;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

let box = 20;
let snake = [];
let food;
let score = 0;
let d;
let playerName;
let snakeColor;
let speed;
let lastRender = 0;
let gameRunning = false;

function startGame() {
  playerName = document.getElementById("playerName").value || "Jogador";
  snakeColor = document.getElementById("snakeColor").value || "green";
  speed = parseInt(document.getElementById("difficulty").value);

  menu.classList.remove("active");
  gameOverScreen.classList.remove("active");
  gameRunning = true;

  snake = [{ x: 9*box, y: 10*box }];
  score = 0;
  d = null;

  generateFood();
  requestAnimationFrame(gameLoop);
}

// Gera comida alinhada no grid
function generateFood() {
  let cols = Math.floor(canvas.width / box);
  let rows = Math.floor(canvas.height / box);
  food = {
    x: Math.floor(Math.random() * cols) * box,
    y: Math.floor(Math.random() * rows) * box
  };
}

// Controles teclado
document.addEventListener("keydown", function(event){
  if (event.keyCode == 37 && d != "RIGHT") d = "LEFT";
  else if (event.keyCode == 38 && d != "DOWN") d = "UP";
  else if (event.keyCode == 39 && d != "LEFT") d = "RIGHT";
  else if (event.keyCode == 40 && d != "UP") d = "DOWN";
});

// Swipe mobile
let startX, startY;
document.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
});
document.addEventListener("touchend", e => {
  let dx = e.changedTouches[0].clientX - startX;
  let dy = e.changedTouches[0].clientY - startY;
  if(Math.abs(dx) > Math.abs(dy)){
    if(dx>0 && d!="LEFT") d="RIGHT";
    else if(dx<0 && d!="RIGHT") d="LEFT";
  } else {
    if(dy>0 && d!="UP") d="DOWN";
    else if(dy<0 && d!="DOWN") d="UP";
  }
});

// Colis√£o
function collision(head,array){
  for(let i=0;i<array.length;i++){
    if(head.x==array[i].x && head.y==array[i].y) return true;
  }
  return false;
}

// Loop do jogo
function gameLoop(timestamp) {
  if (!gameRunning) return;

  if (timestamp - lastRender > speed) {
    update();
    render();
    lastRender = timestamp;
  }

  requestAnimationFrame(gameLoop);
}

function update() {
  let snakeX = snake[0].x;
  let snakeY = snake[0].y;

  if(d=="LEFT") snakeX -= box;
  if(d=="UP") snakeY -= box;
  if(d=="RIGHT") snakeX += box;
  if(d=="DOWN") snakeY += box;

  if(snakeX == food.x && snakeY == food.y){
    score++;
    generateFood();
  } else {
    snake.pop();
  }

  let newHead = {x:snakeX, y:snakeY};

  if(snakeX < 0 || snakeY < 0 || snakeX >= canvas.width || snakeY >= canvas.height || collision(newHead,snake)){
    gameOver();
    return;
  }

  snake.unshift(newHead);
}

function render() {
  ctx.fillStyle="#1e5f1e";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  for(let i=0;i<snake.length;i++){
    ctx.fillStyle = (i==0)? snakeColor : "#a5f0a5";
    ctx.beginPath();
    ctx.arc(snake[i].x + box/2, snake[i].y + box/2, box/2, 0, Math.PI*2);
    ctx.fill();
  }

  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.arc(food.x+box/2, food.y+box/2, box/2, 0, Math.PI*2);
  ctx.fill();

  scoreDisplay.innerText = `${playerName} | Score: ${score}`;
}

function gameOver() {
  gameRunning = false;
  saveScore(playerName, score);
  gameOverText.innerText = `üíÄ Game Over, ${playerName}! Pontua√ß√£o: ${score}`;
  gameOverScreen.classList.add("active");
  updateRanking();
}

function restartGame() {
  startGame();
}

function backToMenu() {
  gameOverScreen.classList.remove("active");
  menu.classList.add("active");
}

// Ranking (localStorage)
function saveScore(name, score) {
  let ranking = JSON.parse(localStorage.getItem("ranking")) || [];
  ranking.push({name, score});
  ranking.sort((a,b) => b.score - a.score);
  ranking = ranking.slice(0,5);
  localStorage.setItem("ranking", JSON.stringify(ranking));
}

function updateRanking() {
  let ranking = JSON.parse(localStorage.getItem("ranking")) || [];
  rankingList.innerHTML = "";
  ranking.forEach(r => {
    let li = document.createElement("li");
    li.textContent = `${r.name} - ${r.score}`;
    rankingList.appendChild(li);
  });
}
updateRanking();
</script>
</body>
</html>
