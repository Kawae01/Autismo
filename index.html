<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>🐍 Snake Deluxe</title>

<style>
  body {
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(to bottom, #1a3d1a, #0e220e);
    height: 100vh;
    overflow: hidden;
    font-family: 'Courier New', monospace;
  }

  canvas {
    border: 10px solid #0d260d;
    background: #1e5f1e;
    display: block;
  }

  #menu {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.8);
    padding: 30px;
    border-radius: 20px;
    color: white;
    text-align: center;
    z-index: 2;
  }

  #menu input, #menu select, #menu button {
    margin: 8px 0;
    padding: 10px;
    font-size: 16px;
    border-radius: 10px;
    border: none;
  }

  #score {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 22px;
    font-weight: bold;
    text-shadow: 2px 2px 4px #000;
    z-index: 2;
  }
</style>
</head>
<body>

<div id="menu">
  <h1>🐍 Snake Deluxe</h1>
  <input type="text" id="playerName" placeholder="Digite seu nome"><br>

  <label>Cor da Cobra: </label>
  <select id="snakeColor">
    <option value="green">Verde</option>
    <option value="blue">Azul</option>
    <option value="purple">Roxo</option>
    <option value="orange">Laranja</option>
    <option value="pink">Rosa</option>
  </select><br>

  <label>Modo de Jogo: </label>
  <select id="gameMode">
    <option value="classic">Clássico</option>
    <option value="infinite">Infinito</option>
    <option value="hardcore">Hardcore</option>
  </select><br>

  <button onclick="startGame()">Iniciar</button>
</div>

<div id="score"></div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreDisplay = document.getElementById("score");
const menu = document.getElementById("menu");

// Ajusta tamanho do canvas
function resizeCanvas() {
  canvas.width = window.innerWidth - 20;
  canvas.height = window.innerHeight - 20;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

const box = 20;
let snake = [];
let food;
let obstacles = [];
let score = 0;
let d;
let game;
let playerName;
let snakeColor;
let mode;

function startGame() {
  playerName = document.getElementById("playerName").value || "Jogador";
  snakeColor = document.getElementById("snakeColor").value || "green";
  mode = document.getElementById("gameMode").value;
  menu.style.display = "none";

  snake = [];
  snake[0] = { x: 10*box, y: 10*box };
  score = 0;
  d = null;
  obstacles = [];

  generateFood();
  if (mode === "hardcore") generateObstacles();

  if(game) clearInterval(game);
  game = setInterval(draw, mode === "hardcore" ? 80 : 100);
}

// Gera comida
function generateFood() {
  food = {
    x: Math.floor(Math.random() * (canvas.width / box)) * box,
    y: Math.floor(Math.random() * (canvas.height / box)) * box
  };
}

// Gera obstáculos no modo hardcore
function generateObstacles() {
  obstacles = [];
  for (let i = 0; i < 10; i++) {
    obstacles.push({
      x: Math.floor(Math.random() * (canvas.width / box)) * box,
      y: Math.floor(Math.random() * (canvas.height / box)) * box
    });
  }
}

// Controles teclado
document.addEventListener("keydown", function(event){
  if (event.keyCode == 37 && d != "RIGHT") d = "LEFT";
  else if (event.keyCode == 38 && d != "DOWN") d = "UP";
  else if (event.keyCode == 39 && d != "LEFT") d = "RIGHT";
  else if (event.keyCode == 40 && d != "UP") d = "DOWN";
  else if (event.keyCode == 80) pauseGame(); // P = pausa
  else if (event.keyCode == 82) restartGame(); // R = reinício
});

// Controles swipe para celular
let startX, startY;
document.addEventListener("touchstart", e => {
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
});
document.addEventListener("touchend", e => {
  let dx = e.changedTouches[0].clientX - startX;
  let dy = e.changedTouches[0].clientY - startY;
  if(Math.abs(dx) > Math.abs(dy)){
    if(dx>0 && d!="LEFT") d="RIGHT";
    else if(dx<0 && d!="RIGHT") d="LEFT";
  } else {
    if(dy>0 && d!="UP") d="DOWN";
    else if(dy<0 && d!="DOWN") d="UP";
  }
});

// Pausa
let paused = false;
function pauseGame() {
  paused = !paused;
}

// Reinício rápido
function restartGame() {
  clearInterval(game);
  menu.style.display = "block";
}

// Colisão
function collision(head,array){
  for(let i=0;i<array.length;i++){
    if(head.x==array[i].x && head.y==array[i].y) return true;
  }
  return false;
}

// Principal
function draw(){
  if (paused) return;

  // Fundo quadriculado
  for (let x = 0; x < canvas.width; x += box) {
    for (let y = 0; y < canvas.height; y += box) {
      ctx.fillStyle = ((x/box + y/box) % 2 == 0) ? "#267326" : "#2e8b2e";
      ctx.fillRect(x,y,box,box);
    }
  }

  // Obstáculos (modo hardcore)
  if (mode === "hardcore") {
    ctx.fillStyle="brown";
    for (let i=0; i<obstacles.length; i++){
      ctx.fillRect(obstacles[i].x, obstacles[i].y, box, box);
    }
  }

  // Cobra
  for(let i=0;i<snake.length;i++){
    ctx.fillStyle = (i==0)? snakeColor : "#a5f0a5";
    ctx.beginPath();
    ctx.arc(snake[i].x + box/2, snake[i].y + box/2, box/2, 0, Math.PI*2);
    ctx.fill();
  }

  // Comida
  ctx.fillStyle="red";
  ctx.beginPath();
  ctx.arc(food.x+box/2, food.y+box/2, box/2, 0, Math.PI*2);
  ctx.fill();

  // Cabeça
  let snakeX = snake[0].x;
  let snakeY = snake[0].y;

  if(d=="LEFT") snakeX -= box;
  if(d=="UP") snakeY -= box;
  if(d=="RIGHT") snakeX += box;
  if(d=="DOWN") snakeY += box;

  // Modos de jogo
  if (mode === "infinite") {
    if (snakeX < 0) snakeX = canvas.width - box;
    if (snakeY < 0) snakeY = canvas.height - box;
    if (snakeX >= canvas.width) snakeX = 0;
    if (snakeY >= canvas.height) snakeY = 0;
  }

  // Comeu comida
  if(snakeX == food.x && snakeY == food.y){
    score++;
    generateFood();
  } else {
    snake.pop();
  }

  let newHead = {x:snakeX, y:snakeY};

  // Colisões (clássico/hardcore)
  if (mode !== "infinite") {
    if(snakeX < 0 || snakeY < 0 || snakeX >= canvas.width || snakeY >= canvas.height){
      return gameOver();
    }
  }

  if (collision(newHead, snake)) return gameOver();

  if (mode === "hardcore" && collision(newHead, obstacles)) return gameOver();

  snake.unshift(newHead);

  // Placar
  scoreDisplay.innerText = `${playerName} | Modo: ${mode} | Score: ${score}`;
}

// Game Over
function gameOver(){
  clearInterval(game);
  alert(`💀 Game Over, ${playerName}! Pontuação: ${score}`);
  menu.style.display="block";
}
</script>
</body>
</html>
